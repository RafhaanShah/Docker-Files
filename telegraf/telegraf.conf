# https://docs.influxdata.com/telegraf/v1/configuration/
# https://github.com/influxdata/telegraf/blob/master/cmd/telegraf/agent.conf
# https://github.com/influxdata/telegraf/blob/master/docs/CONFIGURATION.md
[agent]
  interval = "1000ms" # data reading frequency
  flush_interval = "1000ms" # data writing frequency
  round_interval = true # round reading time to :00, :01 etc
  collection_jitter = "0s" # jitter time for reading
  flush_jitter = "0s" # jitter time for writing
  metric_batch_size = 10 # max batch size for writes
  metric_buffer_limit = 10 # max number of metrics to buffer when writes fail
  omit_hostname = true # remove hostname tag from writes

# https://github.com/influxdata/telegraf/blob/master/docs/CONFIGURATION.md#input-plugins
# https://github.com/influxdata/telegraf/blob/master/plugins/inputs/http/README.md
[[inputs.http]]
  name_override = "msi_afterburner"
  urls = [
    "http://rafs-pc.lan:82/mahm", 
    # "http://lynns-pc.lan:82/mahm"
    ]
  method = "GET"
  username = "MSIAfterburner"
  password = "MOeGCJrrXjTNubsGmaTh"
  data_format = "xml"
  interval = "1000ms"
  timeout = "100ms"

  # https://docs.influxdata.com/telegraf/v1/data_formats/input/xml/
  [[inputs.http.xpath]]
    metric_selection = "/HardwareMonitor/HardwareMonitorEntries"

    # fields to collect
    [inputs.http.xpath.fields]
        cpu_usage = "number(HardwareMonitorEntry[srcName='CPU usage']/data)"
        cpu_temp = "number(HardwareMonitorEntry[srcName='CPU temperature']/data)"
        gpu_usage = "number(HardwareMonitorEntry[srcName='GPU usage']/data)"
        gpu_temp = "number(HardwareMonitorEntry[srcName='GPU temperature']/data)"
        framerate = "number(HardwareMonitorEntry[srcName='Framerate']/data)"
        frametime = "number(HardwareMonitorEntry[srcName='Frametime']/data)"

# https://docs.influxdata.com/telegraf/v1/input-plugins/ping/
# [[inputs.ping]]
#   name_override = "ping"
#   urls = ["1.1.1.1"]
#   count = 1
#   method = "native"
#   interval = "1s"
#   timeout = "1s"
#   deadline = "10s"

# https://github.com/influxdata/telegraf/blob/master/docs/CONFIGURATION.md#output-plugins
# https://github.com/influxdata/telegraf/tree/master/plugins/outputs/websocket
# https://grafana.com/tutorials/stream-metrics-from-telegraf-to-grafana/
# https://grafana.com/docs/grafana/latest/setup-grafana/set-up-grafana-live/
[[outputs.websocket]]
  url = "ws://grafana:3000/api/live/push/msi_afterburner"
  data_format = "influx"
  metric_batch_size = 10
  metric_buffer_limit = 60
  namepass = ["msi_afterburner"]

# https://github.com/influxdata/telegraf/tree/master/plugins/outputs/influxdb
# [[outputs.influxdb]] # no udp on v2
#   urls = ["udp://victoriametrics:8189"]
#   database = "telegraf"
#   skip_database_creation = true
#   exclude_database_tag = true
#   exclude_retention_policy_tag = true
#   timeout = "100ms"
#   metric_batch_size = 10
#   metric_buffer_limit = 60
#   namepass = ["ping"]

# debug output to stdout
# [[outputs.file]]
#   files = ["stdout"]
#   data_format = "influx"
